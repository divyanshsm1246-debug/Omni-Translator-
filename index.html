<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Omni-Translate AI: ROYAL CYBERNETIC</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Tesseract.js -->
    <script src='https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js'></script>
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Cinzel:wght@600;800&family=Rajdhani:wght@600&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'JetBrains Mono', monospace; }
        .royal-font { font-family: 'Cinzel', serif; }
        .tech-font { font-family: 'Rajdhani', sans-serif; }

        /* Custom Animations */
        @keyframes scan-gold {
            0% { top: 0%; opacity: 0; box-shadow: 0 0 5px rgba(255, 215, 0, 0.5); }
            50% { opacity: 1; box-shadow: 0 0 25px rgba(0, 243, 255, 0.9); } /* Blue Glow center */
            100% { top: 100%; opacity: 0; box-shadow: 0 0 5px rgba(255, 215, 0, 0.5); }
        }
        
        @keyframes pulse-border {
            0%, 100% { border-color: rgba(255, 215, 0, 0.3); box-shadow: 0 0 10px rgba(0, 243, 255, 0.1); }
            50% { border-color: rgba(0, 243, 255, 0.6); box-shadow: 0 0 20px rgba(255, 215, 0, 0.2); }
        }

        @keyframes gold-shimmer {
            0% { background-position: -200% center; }
            100% { background-position: 200% center; }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        .animate-scan { animation: scan-gold 2.5s cubic-bezier(0.4, 0, 0.2, 1) infinite; }
        .animate-pulse-border { animation: pulse-border 4s infinite; }
        .animate-shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        
        .glass-panel {
            background: rgba(8, 12, 20, 0.85);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 215, 0, 0.2); /* Subtle Gold Border */
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.8);
        }

        .text-gradient-gold-blue {
            background: linear-gradient(to right, #ffd700, #00f3ff, #ffd700);
            background-size: 200% auto;
            color: transparent;
            -webkit-background-clip: text;
            background-clip: text;
            animation: gold-shimmer 3s linear infinite;
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #050505; }
        ::-webkit-scrollbar-thumb { background: linear-gradient(to bottom, #c5a000, #0088cc); border-radius: 3px; }
    </style>
</head>
<body class="min-h-[100dvh] bg-[#030508] text-cyan-400 overflow-x-hidden relative selection:bg-amber-500 selection:text-black">

    <!-- Matrix Rain Canvas (Gold + Blue) -->
    <canvas id="matrix-canvas" class="fixed top-0 left-0 w-full h-full opacity-25 pointer-events-none z-0"></canvas>
    
    <!-- Hex Grid Background Overlay -->
    <div class="fixed inset-0 z-0 opacity-10 pointer-events-none" style="background-image: radial-gradient(#ffd700 1px, transparent 1px); background-size: 40px 40px;"></div>

    <!-- Hidden Canvas & Input -->
    <canvas id="capture-canvas" class="hidden"></canvas>
    <input type="file" id="file-upload" accept="image/*" class="hidden" onchange="handleFileUpload(event)">

    <!-- MAIN UI CONTAINER -->
    <div class="relative z-10 flex flex-col min-h-[100dvh] p-2 md:p-6 max-w-[1600px] mx-auto gap-4">
        
        <!-- Header: System Status -->
        <header class="glass-panel p-4 rounded-lg flex justify-between items-center border-b border-amber-500/30 relative overflow-hidden">
            <div class="flex items-center gap-4 relative z-10">
                <div class="relative group">
                    <div class="absolute inset-0 bg-amber-500 blur-lg opacity-20 group-hover:opacity-40 transition-opacity"></div>
                    <i data-lucide="crown" class="w-8 h-8 text-amber-400 relative z-10"></i>
                </div>
                <div>
                    <h1 class="text-2xl md:text-3xl font-bold tracking-[0.15em] text-gradient-gold-blue royal-font">
                        OMNI-PRIME
                    </h1>
                    <div class="flex items-center gap-2 text-[10px] md:text-xs text-amber-200/70 font-mono">
                        <span class="inline-block w-2 h-2 bg-cyan-400 rounded-full animate-pulse"></span>
                        SYSTEM: ELITE // NODE: SECURE_GOLD_01
                    </div>
                </div>
            </div>
            <div class="hidden md:flex gap-8 text-xs font-bold font-mono">
                <div class="flex flex-col items-end">
                    <span class="text-amber-500">ENGINE</span>
                    <span class="text-cyan-300">HYBRID_NEURAL</span>
                </div>
                <div class="flex flex-col items-end">
                    <span class="text-amber-500">LINK</span>
                    <span class="text-cyan-300">ENCRYPTED_AES</span>
                </div>
                <div class="flex flex-col items-end">
                    <span class="text-amber-500">PING</span>
                    <span class="text-cyan-300">1ms</span>
                </div>
            </div>
        </header>

        <!-- Main Content Area -->
        <main class="flex-1 grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-6 pb-6">
            
            <!-- LEFT PANEL: Visual Sensor (Camera) -->
            <div class="flex flex-col gap-4">
                <!-- Camera Frame -->
                <div class="relative w-full bg-black/90 rounded-lg border border-amber-500/20 overflow-hidden shadow-[0_0_40px_rgba(255,215,0,0.1)] flex flex-col h-[50vh] lg:h-[70vh] animate-pulse-border">
                    
                    <!-- Decorative HUD Corners (Gold) -->
                    <div class="absolute top-0 left-0 w-12 h-12 border-t-2 border-l-2 border-amber-400 z-20"></div>
                    <div class="absolute top-0 right-0 w-12 h-12 border-t-2 border-r-2 border-amber-400 z-20"></div>
                    <div class="absolute bottom-0 left-0 w-12 h-12 border-b-2 border-l-2 border-amber-400 z-20"></div>
                    <div class="absolute bottom-0 right-0 w-12 h-12 border-b-2 border-r-2 border-amber-400 z-20"></div>

                    <!-- STARTUP / AUTH OVERLAY -->
                    <div id="start-overlay" class="absolute inset-0 z-50 flex flex-col items-center justify-center bg-[#030508]/95 backdrop-blur-md transition-all duration-700">
                        <div id="auth-icon-container" class="relative mb-8 group">
                            <div class="absolute inset-0 bg-gradient-to-r from-amber-500 to-cyan-500 blur-3xl opacity-20 animate-pulse"></div>
                            <div class="w-32 h-32 border-2 border-amber-500/30 flex items-center justify-center relative z-10 rounded-full transition-all duration-500">
                                <i data-lucide="lock" class="w-12 h-12 text-amber-400 animate-pulse"></i>
                            </div>
                        </div>
                        
                        <div id="auth-form-container" class="flex flex-col gap-4 w-full max-w-sm px-6">
                            <div class="relative">
                                <input type="password" id="passkey-input" placeholder="ENTER PASSKEY" class="w-full bg-black/50 border border-amber-500/50 text-cyan-300 px-4 py-3 rounded text-center tracking-[0.2em] focus:outline-none focus:border-cyan-400 focus:shadow-[0_0_15px_rgba(0,243,255,0.3)] transition-all placeholder:text-amber-500/30 font-mono">
                            </div>
                            
                            <p id="login-msg" class="text-red-500 font-bold text-xs tracking-widest text-center h-4 hidden animate-pulse">ACCESS DENIED: INVALID KEY</p>

                            <button onclick="checkPasskey()" class="w-full py-4 bg-amber-900/10 border border-amber-500/50 text-amber-400 font-bold text-lg tracking-[0.2em] hover:bg-amber-500 hover:text-black transition-all duration-300 tech-font clip-path-polygon group">
                                <span class="group-hover:hidden">[ AUTHENTICATE ]</span>
                                <span class="hidden group-hover:inline">[ UNLOCK SYSTEM ]</span>
                            </button>
                        </div>
                        <p id="auth-footer" class="mt-6 text-cyan-500/40 text-[10px] tracking-[0.3em] font-mono">SECURE LOGIN REQUIRED</p>
                    </div>

                    <!-- Video / Image Container -->
                    <div class="relative w-full h-full flex items-center justify-center bg-[#010203] overflow-hidden">
                        <video id="webcam" autoplay muted playsinline class="w-full h-full object-cover opacity-80 hidden grayscale-[20%] contrast-110"></video>
                        <img id="uploaded-image" class="w-full h-full object-contain bg-black hidden opacity-90" />

                        <!-- Standby Icon -->
                        <div id="camera-placeholder" class="flex flex-col items-center justify-center text-amber-700/40 p-4">
                            <i data-lucide="aperture" class="w-24 h-24 mb-4 animate-spin-slow opacity-60"></i>
                            <p id="placeholder-text" class="tracking-[0.3em] text-sm text-cyan-600/60 font-mono">SENSOR STANDBY</p>
                        </div>
                        
                        <!-- Scanning Laser (Blue/Gold Gradient) -->
                        <div id="scan-laser" class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-amber-400 via-cyan-400 to-amber-400 shadow-[0_0_30px_#00F3FF] animate-scan opacity-0 z-10"></div>
                        
                        <!-- Grid Overlay -->
                        <div class="absolute inset-0 pointer-events-none opacity-10" style="background-image: linear-gradient(0deg, transparent 49%, #ffd700 49%, #ffd700 51%, transparent 51%), linear-gradient(90deg, transparent 49%, #00f3ff 49%, #00f3ff 51%, transparent 51%); background-size: 60px 60px;"></div>
                        
                        <!-- Status Badge -->
                        <div class="absolute top-4 left-1/2 transform -translate-x-1/2 bg-black/80 border border-amber-500/40 px-6 py-1 rounded text-amber-100 font-mono text-xs tracking-widest backdrop-blur-md shadow-[0_0_15px_rgba(255,215,0,0.1)]">
                           <span id="status-pill">AWAITING AUTHORIZATION</span>
                        </div>
                    </div>

                    <!-- Action Bar (Initially Hidden/Disabled via Start Overlay) -->
                    <div class="absolute bottom-0 left-0 w-full bg-gradient-to-t from-black via-black/90 to-transparent p-6 z-30 flex justify-center gap-4">
                        <button 
                            id="upload-btn"
                            onclick="triggerFileUpload()"
                            class="hidden p-4 bg-cyan-900/20 backdrop-blur border border-cyan-500/50 text-cyan-400 hover:bg-cyan-500 hover:text-black transition-all duration-200"
                            title="Upload File"
                        >
                            <i data-lucide="upload" class="w-6 h-6"></i>
                        </button>
                        <button 
                            id="scan-btn"
                            disabled
                            onclick="initiateScan()"
                            class="w-full md:max-w-md py-4 bg-black/60 backdrop-blur border border-amber-500 text-amber-400 font-bold text-xl tracking-[0.25em] hover:bg-amber-500 hover:text-black hover:shadow-[0_0_30px_rgba(255,215,0,0.4)] transition-all duration-200 clip-path-polygon disabled:opacity-50 disabled:cursor-not-allowed group-hover:scale-[1.02] tech-font"
                        >
                            INITIATE SCAN
                        </button>
                    </div>
                </div>
            </div>

            <!-- RIGHT PANEL: Data Analysis (Translation) -->
            <div class="flex flex-col h-[50vh] lg:h-[70vh]">
                <div class="glass-panel flex-1 rounded-lg flex flex-col overflow-hidden relative border-t border-t-amber-500/30">
                    
                    <!-- Header -->
                    <div class="bg-black/40 p-4 border-b border-cyan-500/20 flex justify-between items-center">
                        <div class="flex items-center gap-2 text-amber-400">
                            <i data-lucide="database" class="w-5 h-5"></i>
                            <span class="font-bold tracking-wider tech-font">TRANSLATION MATRIX</span>
                        </div>
                        <span id="confidence-badge" class="hidden text-[10px] font-mono text-cyan-300 bg-cyan-900/20 px-2 py-1 rounded border border-cyan-500/30">INTEGRITY: 100%</span>
                    </div>

                    <!-- Scrollable Content Area -->
                    <div class="flex-1 overflow-y-auto p-6 relative custom-scrollbar bg-gradient-to-b from-transparent to-cyan-900/5">
                        
                        <!-- Standby View -->
                        <div id="result-standby" class="absolute inset-0 flex flex-col items-center justify-center text-cyan-800/40 gap-4">
                            <div class="relative">
                                <div class="absolute inset-0 bg-cyan-500 blur-2xl opacity-10 animate-pulse"></div>
                                <i data-lucide="globe-2" class="w-24 h-24 opacity-80 animate-pulse"></i>
                            </div>
                            <p class="text-sm tracking-[0.2em] font-mono text-amber-500/50">WAITING FOR DATA PACKETS...</p>
                        </div>

                        <!-- Results View -->
                        <div id="result-content" class="hidden relative z-10 space-y-8 pb-10">
                            
                            <!-- Metadata Grid -->
                            <div class="grid grid-cols-2 md:grid-cols-3 gap-2 text-[10px] font-mono border-b border-amber-500/10 pb-4">
                                <div class="bg-black/40 px-3 py-2 rounded border border-cyan-900 text-center">
                                    <span class="text-gray-500 block">TYPE</span> 
                                    <span id="res-type" class="text-cyan-300">UNKNOWN</span>
                                </div>
                                <div class="bg-black/40 px-3 py-2 rounded border border-cyan-900 text-center">
                                    <span class="text-gray-500 block">PROTOCOL</span> 
                                    <span id="res-era" class="text-amber-300">HTTPS/SECURE</span>
                                </div>
                                <div class="bg-black/40 px-3 py-2 rounded border border-cyan-900 text-center col-span-2 md:col-span-1">
                                    <span class="text-gray-500 block">SOURCE LANG</span> 
                                    <span id="res-detected" class="text-green-400">AUTO-DETECT</span>
                                </div>
                            </div>

                            <!-- Source Text Block -->
                            <div class="group relative">
                                <div class="absolute -left-1 top-0 bottom-0 w-1 bg-gradient-to-b from-amber-500 to-transparent"></div>
                                <h3 class="text-xs text-amber-500/70 tracking-widest mb-2 flex items-center gap-2 pl-3">
                                    <i data-lucide="scan-text" class="w-3 h-3"></i> INPUT_DATA
                                </h3>
                                <div class="bg-black/30 border border-amber-500/20 p-4 rounded-r hover:bg-black/50 transition-colors">
                                    <p id="res-original" class="text-sm md:text-base text-gray-300 leading-relaxed font-serif whitespace-pre-wrap break-words"></p>
                                </div>
                            </div>

                            <!-- Connector -->
                            <div class="flex justify-center items-center py-2 opacity-60">
                                <i data-lucide="arrow-down-circle" class="w-6 h-6 text-cyan-500 animate-bounce"></i>
                            </div>

                            <!-- Translation Block -->
                            <div class="group">
                                <div class="flex justify-between items-center mb-2">
                                    <h3 class="text-xs text-cyan-500/70 tracking-widest flex items-center gap-2">
                                        <i data-lucide="check-circle-2" class="w-3 h-3"></i> <span id="translation-label">TARGET_OUTPUT (HINDI)</span>
                                    </h3>
                                    <!-- Action Buttons -->
                                    <div class="flex gap-2">
                                        <button onclick="speakText()" class="p-1.5 rounded border border-cyan-500/20 hover:bg-cyan-500/20 text-cyan-400 transition-colors" title="Speak">
                                            <i data-lucide="volume-2" class="w-4 h-4"></i>
                                        </button>
                                        <button onclick="copyToClipboard()" class="p-1.5 rounded border border-amber-500/20 hover:bg-amber-500/20 text-amber-400 transition-colors" title="Copy">
                                            <i data-lucide="copy" class="w-4 h-4"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="bg-gradient-to-br from-cyan-900/10 to-blue-900/5 border border-cyan-500/40 p-6 rounded relative overflow-hidden shadow-[0_0_30px_rgba(0,243,255,0.05)]">
                                    <div class="absolute top-0 right-0 p-2 opacity-5">
                                        <i data-lucide="brain-circuit" class="w-20 h-20 text-cyan-400"></i>
                                    </div>
                                    <p id="res-hindi" class="text-lg md:text-xl text-cyan-100 font-medium leading-loose tracking-wide whitespace-pre-wrap"></p>
                                </div>
                            </div>

                        </div>
                    </div>

                    <!-- Footer Data Stream -->
                    <div class="h-8 bg-black/80 border-t border-amber-500/20 flex items-center px-4 overflow-hidden">
                        <p class="text-[9px] text-amber-600/80 font-mono whitespace-nowrap animate-pulse flex gap-4">
                            <span>> ENCRYPTION: AES-256</span>
                            <span>> NODE: BANGALORE_04</span>
                            <span>> UPTIME: 99.999%</span>
                            <span>> PROCESSING: NEURAL_ENGINE</span>
                        </p>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <script>
        // --- 1. Gold & Blue Matrix Rain ---
        const canvas = document.getElementById('matrix-canvas');
        const ctx = canvas.getContext('2d');

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789$@#%&'; 
        const fontSize = 14;
        let columns = canvas.width / fontSize;
        const drops = [];

        function initDrops() {
            columns = canvas.width / fontSize;
            for (let x = 0; x < columns; x++) {
                drops[x] = 1;
            }
        }
        initDrops();

        function drawMatrix() {
            ctx.fillStyle = 'rgba(3, 5, 8, 0.05)'; 
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.font = fontSize + 'px monospace';

            for (let i = 0; i < drops.length; i++) {
                const text = chars.charAt(Math.floor(Math.random() * chars.length));
                ctx.fillStyle = Math.random() > 0.5 ? '#FFD700' : '#00F3FF';
                ctx.fillText(text, i * fontSize, drops[i] * fontSize);

                if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) {
                    drops[i] = 0;
                }
                drops[i]++;
            }
        }
        setInterval(drawMatrix, 33);


        // --- 2. System Logic & Variables ---
        let isScanning = false;
        let mode = 'standby'; 
        
        const videoElement = document.getElementById('webcam');
        const uploadedImage = document.getElementById('uploaded-image');
        const fileInput = document.getElementById('file-upload');
        const captureCanvas = document.getElementById('capture-canvas');
        const placeholder = document.getElementById('camera-placeholder');
        const placeholderText = document.getElementById('placeholder-text');
        const laser = document.getElementById('scan-laser');
        const statusPill = document.getElementById('status-pill');
        const scanBtn = document.getElementById('scan-btn');
        const uploadBtn = document.getElementById('upload-btn');
        const resultStandby = document.getElementById('result-standby');
        const resultContent = document.getElementById('result-content');
        const startOverlay = document.getElementById('start-overlay');
        const passkeyInput = document.getElementById('passkey-input');
        const loginMsg = document.getElementById('login-msg');
        const authFormContainer = document.getElementById('auth-form-container');
        const authIconContainer = document.getElementById('auth-icon-container');
        const authFooter = document.getElementById('auth-footer');

        lucide.createIcons();
        
        // --- AUTHENTICATION LOGIC ---
        function checkPasskey() {
            const val = passkeyInput.value;
            if (val === "1x2x3x4x5x") {
                // Success State
                loginMsg.classList.add('hidden');
                
                // Visual Transition for Welcome Message
                // 1. Change Lock Icon
                if(authIconContainer) {
                    authIconContainer.innerHTML = '<i data-lucide="unlock" class="w-16 h-16 text-cyan-400 animate-bounce"></i>';
                    lucide.createIcons();
                }

                // 2. Hide Footer
                if(authFooter) authFooter.style.opacity = '0';

                // 3. Replace Form with Welcome Text
                authFormContainer.innerHTML = `
                    <div class="text-center animate-in fade-in zoom-in duration-1000">
                        <h2 class="text-2xl md:text-3xl font-bold tracking-widest text-gradient-gold-blue royal-font mb-4 drop-shadow-[0_0_10px_rgba(255,215,0,0.5)]">
                            WELCOME BACK
                        </h2>
                        <h3 class="text-xl md:text-2xl font-bold tracking-[0.2em] text-cyan-300 tech-font border-t border-b border-cyan-500/30 py-2">
                            Mr. Prateek Gupta
                        </h3>
                        <p class="text-xs text-amber-500/70 mt-4 font-mono animate-pulse">RESTORING PREFERENCES...</p>
                    </div>
                `;
                
                // 4. Wait then Unlock
                setTimeout(() => {
                    startSystem();
                }, 3500);

            } else {
                // Fail State
                loginMsg.classList.remove('hidden');
                passkeyInput.value = "";
                passkeyInput.classList.add('animate-shake');
                setTimeout(() => passkeyInput.classList.remove('animate-shake'), 500);
            }
        }

        function startSystem() {
            startOverlay.classList.add('hidden');
            uploadBtn.classList.remove('hidden');
            placeholderText.textContent = "INITIALIZING SENSORS...";
            initCamera();
        }

        function triggerFileUpload() { fileInput.click(); }

        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                mode = 'upload';
                videoElement.classList.add('hidden');
                videoElement.pause();
                placeholder.classList.add('hidden');
                uploadedImage.src = e.target.result;
                uploadedImage.classList.remove('hidden');
                statusPill.textContent = "FILE LOADED";
                statusPill.classList.remove('text-amber-100');
                statusPill.classList.add('text-cyan-400');
                scanBtn.disabled = false;
            };
            reader.readAsDataURL(file);
        }

        async function initCamera() {
            mode = 'camera';
            uploadedImage.classList.add('hidden');
            try {
                const constraints = { video: { facingMode: "environment" } };
                const stream = await navigator.mediaDevices.getUserMedia(constraints);
                videoElement.srcObject = stream;
                videoElement.onloadedmetadata = () => {
                   videoElement.play();
                   videoElement.classList.remove('hidden');
                   placeholder.classList.add('hidden');
                   statusPill.textContent = "OPTICAL FEED: ACTIVE";
                   statusPill.classList.remove('text-amber-100');
                   statusPill.classList.add('text-green-400');
                   scanBtn.disabled = false;
                };
            } catch (err) {
                console.warn("Camera access failed", err);
                statusPill.textContent = "MANUAL UPLOAD REQUIRED";
                placeholderText.innerHTML = "ACCESS DENIED<br><span class='text-xs text-amber-500'>USE FILE UPLOAD</span>";
                videoElement.classList.add('hidden');
                placeholder.classList.remove('hidden');
                scanBtn.disabled = false;
            }
        }

        function initiateScan() {
            if (isScanning) return;
            isScanning = true;

            scanBtn.disabled = true;
            scanBtn.innerHTML = "UPLOADING TO NEURAL NET <span class='animate-pulse'>...</span>";
            laser.classList.remove('opacity-0');
            laser.classList.add('animate-scan');
            resultContent.classList.add('hidden');
            resultStandby.classList.remove('hidden');
            statusPill.textContent = "PROCESSING...";

            const scrollTarget = mode === 'upload' ? uploadedImage : videoElement;
            scrollTarget.scrollIntoView({ behavior: 'smooth', block: 'center' });

            setTimeout(() => {
                scanBtn.innerHTML = "TRANSLATING...";
                if (mode === 'camera' && !videoElement.classList.contains('hidden')) {
                    performRealOCR(videoElement);
                } else if (mode === 'upload') {
                    performRealOCR(uploadedImage);
                } else {
                    processRealText("Error: No Input Source Detected.", 0);
                }
            }, 1000);
        }

        async function performRealOCR(source) {
            statusPill.textContent = "EXTRACTING TEXT...";
            captureCanvas.width = source.videoWidth || source.naturalWidth;
            captureCanvas.height = source.videoHeight || source.naturalHeight;
            const ctx = captureCanvas.getContext('2d');
            ctx.drawImage(source, 0, 0, captureCanvas.width, captureCanvas.height);
            const imageData = captureCanvas.toDataURL('image/png');

            try {
                const { data: { text, confidence } } = await Tesseract.recognize(imageData, 'eng');
                const cleanText = text.trim();
                
                if (cleanText.length > 0) {
                    processRealText(cleanText, confidence);
                } else {
                    processRealText("No legible text detected. Please try again with clearer text.", 0);
                }
            } catch (err) {
                console.error("OCR Failed:", err);
                processRealText("Error: OCR Engine Failed to Initialize.", 0);
            }
        }

        // --- 3. CORE TRANSLATION LOGIC (API FETCH) ---
        async function processRealText(text, confidence) {
            let translatedText = "";
            let type = "TEXT DATA";
            
            // Check for Numbers
            const numberMatch = text.match(/^[$£€₹]?\s*[\d,\.]+\s*[$£€₹]?$/);

            if (numberMatch) {
                translatedText = text + " (Numeric)";
                type = "NUMERIC";
                updateUI(text, translatedText, type, confidence, "LOCAL ENGINE");
            } else {
                // API Call
                try {
                    statusPill.textContent = "CLOUD TRANSLATION...";
                    
                    // MyMemory API
                    const url = `https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=Autodetect|hi`;
                    
                    const response = await fetch(url);
                    const data = await response.json();
                    
                    if(data.responseData && data.responseData.translatedText) {
                        translatedText = data.responseData.translatedText;
                        updateUI(text, translatedText, type, confidence, "MYMEMORY API");
                    } else {
                        throw new Error("Invalid API response");
                    }
                } catch (e) {
                    console.error("Translation API Failed", e);
                    translatedText = "Translation Server Unavailable (Offline or Limit Reached).\n\nOriginal Text Captured:\n" + text;
                    updateUI(text, translatedText, "ERROR / OFFLINE", confidence, "OFFLINE");
                }
            }
        }

        function updateUI(original, translated, type, confidence, sourceEngine) {
            // Update Text
            document.getElementById('res-type').textContent = type;
            document.getElementById('res-era').textContent = sourceEngine;
            document.getElementById('res-original').textContent = original;
            document.getElementById('res-hindi').textContent = translated;
            
            // Layout Adjustments
            if (type === 'NUMERIC') {
                document.getElementById('translation-label').textContent = "VALUE CONVERSION";
                document.getElementById('res-hindi').classList.add('font-mono'); 
            } else {
                document.getElementById('translation-label').textContent = "TRANSLATED HINDI";
                document.getElementById('res-hindi').classList.remove('font-mono');
            }

            // Switch Views
            resultStandby.classList.add('hidden');
            resultContent.classList.remove('hidden');
            
            // Reset Buttons
            statusPill.textContent = "COMPLETE";
            scanBtn.innerHTML = "SCAN NEXT TARGET";
            scanBtn.disabled = false;
            laser.classList.remove('animate-scan');
            laser.classList.add('opacity-0');
            isScanning = false;
            
            lucide.createIcons();
            
            if(window.innerWidth < 1024) {
                 resultContent.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }

        function speakText() {
            const text = document.getElementById('res-hindi').textContent;
            if(!text) return;
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'hi-IN';
            window.speechSynthesis.speak(utterance);
        }

        function copyToClipboard() {
            const text = document.getElementById('res-hindi').textContent;
            if(!text) return;
            navigator.clipboard.writeText(text).then(() => {
                const pill = document.getElementById('status-pill');
                pill.textContent = "COPIED TO CLIPBOARD";
                setTimeout(() => { pill.textContent = "COMPLETE"; }, 2000);
            });
        }

    </script>
</body>
</html>